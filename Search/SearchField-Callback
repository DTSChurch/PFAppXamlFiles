<StackLayout Margin="20">

        <Rock:FieldContainer>
            <Rock:TextBox x:Name="SearchTerm" Text="{{ Parameters.Term | Escape }}" Label="Search" />
        </Rock:FieldContainer>


    <Button Text="Search"
            StyleClass="btn, btn-primary"
            Command="{Binding Callback}">
        <Button.CommandParameter>
            <Rock:CallbackParameters Name="Search">
                <Rock:Parameter Name="Term"
                                Value="{Binding Source={x:Reference SearchTerm}, Path=Text}" />
            </Rock:CallbackParameters>
        </Button.CommandParameter>
    </Button>

    {% if Command == "Search" %}
        <StackLayout>
    <StackLayout.Behaviors>
    	<Rock:EntranceTransition Duration="50" />
    </StackLayout.Behaviors>

            {% search query:'{{ Parameters.Term }}' entities:'content channel item' %}
                {% for result in results %}

                    {% contentchannelitem id:'{{result.Id}}' securityenabled:'false' %}
                    {% assign item = contentchannelitem %}
                    {% assign messageSeriesRelation = contentchannelitem.ParentItems | First %}
                    {% assign messageSeries = messageSeriesRelation.ContentChannelItem %}
                    {% assign ImageId = messageSeries | Attribute:'SeriesImage','RawValue' %}


                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <Grid.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding PushPage}" CommandParameter="591490d1-3d0d-43e3-b572-bc3575260a5c?ItemId={{item.Id}}" />
                        </Grid.GestureRecognizers>


                       <Rock:StyledView
                            CornerRadius="15"
                            HasShadow="True"
                            Elevation="1"
                            Padding="0"
                            Margin="10,5,10,5"
                            Grid.Row="0"
                            Grid.Column="0"
                            Grid.ColumnSpan="3"
                            IsClippedToBounds="True">
                            <Rock:Image MarginBottom="-64" HeightRequest="220" Source="{Binding ImageId, StringFormat='{{ 'Global' | Attribute:'PublicApplicationRoot' }}/GetImage.ashx?Guid={0}'}" Aspect="AspectFill" VerticalOptions="CenterAndExpand"/>
                        </Rock:StyledView>

                        <Label Text="{{item.Title}}"
                            TextColor="{Rock:PaletteColor App-Light}"
                            VerticalTextAlignment="Center"
                            HorizontalTextAlignment="Center"
                            Grid.Row="0"
                            Grid.Column="0"
                            Grid.ColumnSpan="2"
                            StyleClass="text-lg" />

                        <Label Text="Speaker: {{item | Attribute:'Speaker'}}"
                            TextColor="{Rock:PaletteColor App-Light}"
                            Margin="0,0,20,20"
                            HorizontalTextAlignment="Right"
                            VerticalTextAlignment="End"
                            Grid.Row="0"
                            Grid.Column="2"
                            StyleClass="heading4" />

                        <Rock:FollowingIcon EntityTypeId="{{ item.TypeId }}"
                            EntityId="{{ item.Id }}"
                            FontSize="22"
                            IsFollowed="{{ item | IsFollowed }}"
                            FollowingIconColor="{Rock:PaletteColor App-Light}"
                            NotFollowingIconColor="{Rock:PaletteColor App-Light}"
                            HorizontalTextAlignment="Right"
                            VerticalTextAlignment="Start"
                                Margin="0,20,20,0"
                            Grid.Row="0"
                            Grid.Column="2" />

                    </Grid>
                        <Rock:Image HeightRequest="220" Source="{{ 'Global' | Attribute:'PublicApplicationRoot' }}/GetImage.ashx?Guid={{imageId}}" Aspect="AspectFill" VerticalOptions="CenterAndExpand"/>
                    {% endcontentchannelitem %}

                {% endfor %}
            {% endsearch %}
            </StackLayout>

    {% endif %}
</StackLayout>
